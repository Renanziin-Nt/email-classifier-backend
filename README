 Email Classifier API with WebSocket

Uma API moderna para classificaÃ§Ã£o inteligente de emails com suporte a WebSockets para atualizaÃ§Ãµes em tempo real.
ğŸš€ Funcionalidades Principais

    ğŸ¤– ClassificaÃ§Ã£o AI: Identifica emails produtivos vs improdutivos

    ğŸ’¬ Respostas AutomÃ¡ticas: Gera respostas contextualizadas

    âš¡ WebSocket Support: AtualizaÃ§Ãµes em tempo real

    ğŸ“ Multi-format: Suporte a texto, TXT e PDF

    ğŸ¯ Async Processing: Processamento assÃ­ncrono com jobs

    ğŸ”’ Rate Limiting: ProteÃ§Ã£o contra abuso

    ğŸŒ CORS Configurado: Pronto para frontend

ğŸ› ï¸ Tecnologias Utilizadas

    Python 3.12 + FastAPI - Backend moderno e rÃ¡pido

    WebSocket - ComunicaÃ§Ã£o em tempo real

    Scikit-learn - Machine Learning integrado

    NLTK - Processamento de linguagem natural

    Google Gemini + Hugging Face - APIs de IA opcionais

    Uvicorn - Servidor de alta performance

ğŸ“¦ InstalaÃ§Ã£o RÃ¡pida
bash

# 1. Clone e entre na pasta
git clone https://github.com/seu-usuario/email-classifier-backend.git
cd email-classifier-backend

# 2. Ambiente virtual
python -m venv venv
source venv/bin/activate  # Linux/Mac
# ou
venv\Scripts\activate     # Windows

# 3. Instale dependÃªncias
pip install -r requirements.txt

# 4. Recursos NLP
python -c "
import nltk
nltk.download('punkt')
nltk.download('stopwords') 
nltk.download('punkt_tab')
print('âœ… NLP resources installed!')
"

# 5. Configure (opcional)
cp .env.example .env
# Edite .env com suas API keys

âš¡ Como Executar
Desenvolvimento com Auto-reload
bash

uvicorn app.main:app --reload --host 0.0.0.0 --port 8000

ProduÃ§Ã£o
bash

uvicorn app.main:app --host 0.0.0.0 --port 8000 --workers 4

Com Docker
bash

docker build -t email-classifier-api .
docker run -p 8000:8000 email-classifier-api

ğŸ”Œ WebSocket - Como Usar
ConexÃ£o WebSocket
javascript

// Exemplo de cliente WebSocket
const socket = new WebSocket('ws://localhost:8000/ws/job-status/{job_id}');

socket.onmessage = (event) => {
    const data = JSON.parse(event.data);
    console.log('Status update:', data);
};

socket.onopen = () => {
    console.log('WebSocket connected!');
};

Exemplo de Fluxo

    Crie um job via POST /classify-email

    Conecte WebSocket com o job_id retornado

    Receba updates em tempo real

    ConexÃ£o fecha automaticamente quando o job termina

ğŸ“¡ API Endpoints
POST /classify-email

Cria um novo job de classificaÃ§Ã£o.

Body:

    text: string (opcional) - Texto do email

    file: file (opcional) - Arquivo TXT/PDF

Response:
json

{
  "job_id": "uuid-string",
  "status": "pending",
  "message": "Job created successfully"
}

GET /job-status/{job_id}

Verifica status do job (polling tradicional).

Response:
json

{
  "job_id": "uuid-string",
  "status": "processing",
  "progress": 50,
  "current_step": "Classifying email...",
  "result": null,
  "error": null
}

WebSocket /ws/job-status/{job_id}

ConexÃ£o em tempo real - Recebe updates automÃ¡ticos.
DELETE /job/{job_id}

Remove job da memÃ³ria.
GET /health

Status da API e jobs ativos.
ğŸ¯ Exemplos de Uso
cURL - Criar Job
bash

# Com texto
curl -X POST "http://localhost:8000/classify-email" \
  -H "Content-Type: application/json" \
  -d '{"text": "Preciso de ajuda com erro no sistema"}'

# Com arquivo
curl -X POST "http://localhost:8000/classify-email" \
  -F "file=@email.pdf"

JavaScript - WebSocket
javascript

// Conectar ao WebSocket
async function connectWebSocket(jobId) {
    const ws = new WebSocket(`ws://localhost:8000/ws/job-status/${jobId}`);
    
    ws.onmessage = (event) => {
        const data = JSON.parse(event.data);
        updateUI(data);
    };
    
    ws.onclose = () => {
        console.log('Connection closed - job completed');
    };
}

Python - Cliente Completo
python

import requests
import json
import asyncio
import websockets

# Criar job
response = requests.post("http://localhost:8000/classify-email", 
    json={"text": "OlÃ¡, preciso de suporte tÃ©cnico urgente"}
)
job_id = response.json()["job_id"]

# Conectar WebSocket
async def track_job():
    async with websockets.connect(f"ws://localhost:8000/ws/job-status/{job_id}") as ws:
        async for message in ws:
            data = json.loads(message)
            print(f"Progress: {data['progress']}% - {data['message']}")
            
            if data['status'] == 'completed':
                print("Resultado:", data['result'])
                break

asyncio.run(track_job())

âš™ï¸ ConfiguraÃ§Ã£o
VariÃ¡veis de Ambiente (.env)
env

FRONTEND_URL=http://localhost:3000
GEMINI_API_KEY=your_gemini_key_here
HF_API_KEY=your_huggingface_key_here
HOST=0.0.0.0
PORT=8000
DEBUG=True

Sem VariÃ¡veis de Ambiente

O sistema funciona perfeitamente sem APIs externas usando:

    âœ… Modelo Machine Learning local

    âœ… Templates inteligentes de resposta

    âœ… Processamento completo offline

ğŸ—ï¸ Estrutura do Projeto
text

app/
â”œâ”€â”€ main.py                 # FastAPI app + WebSocket handlers
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ schemas.py          # Pydantic models
â”‚   â””â”€â”€ ml_model.py         # ML model training/prediction
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ ai_service.py       # AI integration layer
â”‚   â”œâ”€â”€ classifier.py       # Email classification
â”‚   â”œâ”€â”€ response_generator.py # Response generation
â”‚   â””â”€â”€ email_processor.py  # Text processing
â””â”€â”€ utils/
    â””â”€â”€ logging_utils.py    # Logging configuration

ğŸ”’ Rate Limiting

O sistema inclui proteÃ§Ã£o automÃ¡tica:

    â° 500ms entre requests de status

    ğŸ“Š Log de tentativas excessivas

    ğŸ›¡ï¸ ProteÃ§Ã£o por IP e endpoint

ğŸ› SoluÃ§Ã£o de Problemas
Erro de CORS
bash

# Verifique se o FRONTEND_URL estÃ¡ correto no .env
# Ou ajuste no cÃ³digo:
allow_origins=["http://localhost:3000", "http://127.0.0.1:3000"]

WebSocket NÃ£o Conecta
javascript

// Verifique se o backend estÃ¡ rodando
// E se o job_id existe
console.log('WebSocket status:', socket.readyState);

Erro de NLP Resources
bash

python -c "import nltk; nltk.download('punkt'); nltk.download('stopwords')"

ğŸ“Š Monitoramento
Logs em Tempo Real
text

ğŸ“Š Job a1b2c3d4: processing - Processing email... (30%)
âœ… Job a1b2c3d4 completed successfully!
âš ï¸ Rate limit exceeded for 127.0.0.1 on /job-status/...

Health Check
bash

curl http://localhost:8000/health
# {"status":"healthy","active_jobs":3,"version":"1.0.0"}

ğŸš€ Deploy em ProduÃ§Ã£o
1. Traditional Server
bash

uvicorn app.main:app --host 0.0.0.0 --port 8000 --workers 4

2. Docker
dockerfile

FROM python:3.12-slim
COPY . /app
WORKDIR /app
RUN pip install -r requirements.txt
CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000"]

3. Cloud (AWS/Google Cloud)

    Configure reverse proxy para WebSocket

    Ajuste timeouts para conexÃµes longas

    Configure SSL para WSS (WebSocket Secure)

ğŸ¤ Contribuindo

    Fork o projeto

    Crie sua feature branch (git checkout -b feature/AmazingFeature)

    Commit (git commit -m 'Add AmazingFeature')

    Push (git push origin feature/AmazingFeature)

    Abra um Pull Request